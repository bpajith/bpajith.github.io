<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>First Order Ordinary Differential Equations</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/*
*   math2html: convert LaTeX equations to HTML output.
*
*   Copyright (C) 2009,2010 Alex Fernández
*
*   Released under the terms of the `2-Clause BSD license'_, in short:
*   Copying and distribution of this file, with or without modification,
*   are permitted in any medium without royalty provided the copyright
*   notice and this notice are preserved.
*   This file is offered as-is, without any warranty.
*
* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause
*
*   Based on eLyXer: convert LyX source files to HTML output.
*   http://elyxer.nongnu.org/
*/
/* --end--
* CSS file for LaTeX formulas.
*/

/* Formulas */
.formula {
	text-align: center;
	font-family: "Droid Serif", "DejaVu Serif", "STIX", serif;
	margin: 1.2em 0;
}
span.formula {
	white-space: nowrap;
}
div.formula {
	padding: 0.5ex;
	margin-left: auto;
	margin-right: auto;
}

/* Basic features */
a.eqnumber {
	display: inline-block;
	float: right;
	clear: right;
	font-weight: bold;
}
span.unknown {
	color: #800000;
}
span.ignored, span.arraydef {
	display: none;
}
.formula i {
	letter-spacing: 0.1ex;
}

/* Alignment */
.align-left, .align-l {
	text-align: left;
}
.align-right, .align-r {
	text-align: right;
}
.align-center, .align-c {
	text-align: center;
}

/* Structures */
span.overline, span.bar {
	text-decoration: overline;
}
.fraction, .fullfraction {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
}
.fraction .fraction {
	font-size: 80%;
	line-height: 100%;
}
span.numerator {
	display: block;
}
span.denominator {
	display: block;
	padding: 0ex;
	border-top: thin solid;
}
sup.numerator, sup.unit {
	font-size: 70%;
	vertical-align: 80%;
}
sub.denominator, sub.unit {
	font-size: 70%;
	vertical-align: -20%;
}
span.sqrt {
	display: inline-block;
	vertical-align: middle;
	padding: 0.1ex;
}
sup.root {
	font-size: 70%;
	position: relative;
	left: 1.4ex;
}
span.radical {
	display: inline-block;
	padding: 0ex;
	font-size: 150%;
	vertical-align: top;
}
span.root {
	display: inline-block;
	border-top: thin solid;
	padding: 0ex;
	vertical-align: middle;
}
span.symbol {
	line-height: 125%;
	font-size: 125%;
}
span.bigsymbol {
	line-height: 150%;
	font-size: 150%;
}
span.largesymbol {
	font-size: 175%;
}
span.hugesymbol {
	font-size: 200%;
}
span.scripts {
	display: inline-table;
	vertical-align: middle;
}
.script {
	display: table-row;
	text-align: left;
	line-height: 150%;
}
span.limits {
	display: inline-table;
	vertical-align: middle;
}
.limit {
	display: table-row;
	line-height: 99%;
}
sup.limit, sub.limit {
	line-height: 100%;
}
span.symbolover {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 100%;
	bottom: 0.5em;
	width: 0px;
}
span.withsymbol {
	display: inline-block;
}
span.symbolunder {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 80%;
	top: 0.3em;
	width: 0px;
}

/* Environments */
span.array, span.bracketcases, span.binomial, span.environment {
	display: inline-table;
	text-align: center;
	border-collapse: collapse;
	margin: 0em;
	vertical-align: middle;
}
span.arrayrow, span.binomrow {
	display: table-row;
	padding: 0ex;
	border: 0ex;
}
span.arraycell, span.bracket, span.case, span.binomcell, span.environmentcell {
	display: table-cell;
	padding: 0ex 0.2ex;
	line-height: 99%;
	border: 0ex;
}
/*
* CSS file for LaTeX formulas, extra stuff:
* binomials, vertical braces, stackrel, fonts and colors.
*/

/* Inline binomials */
span.binom {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
	font-size: 80%;
}
span.binomstack {
	display: block;
	padding: 0em;
}

/* Over- and underbraces */
span.overbrace {
	border-top: 2pt solid;
}
span.underbrace {
	border-bottom: 2pt solid;
}

/* Stackrel */
span.stackrel {
	display: inline-block;
	text-align: center;
}
span.upstackrel {
	display: block;
	padding: 0em;
	font-size: 80%;
	line-height: 64%;
	position: relative;
	top: 0.15em;

}
span.downstackrel {
	display: block;
	vertical-align: bottom;
	padding: 0em;
}

/* Fonts */
span.mathsf, span.textsf {
	font-style: normal;
	font-family: sans-serif;
}
span.mathrm, span.textrm {
	font-style: normal;
	font-family: serif;
}
span.text, span.textnormal {
	font-style: normal;
}
span.textipa {
	color: #008080;
}
span.fraktur {
	font-family: "Lucida Blackletter", eufm10, blackletter;
}
span.blackboard {
	font-family: Blackboard, msbm10, serif;
}
span.scriptfont {
	font-family: "Monotype Corsiva", "Apple Chancery", "URW Chancery L", cursive;
	font-style: italic;
}

/* Colors */
span.colorbox {
	display: inline-block;
	padding: 5px;
}
span.fbox {
	display: inline-block;
	border: thin solid black;
	padding: 2px;
}
span.boxed, span.framebox {
	display: inline-block;
	border: thin solid black;
	padding: 5px;
}


</style>
</head>
<body>
<div class="document" id="first-order-ordinary-differential-equations">
<h1 class="title">First Order Ordinary Differential Equations</h1>

<p>Differential equations are one of the most important mathematical tools used in producing models for physical and biological processes. Analytic solutions are available in some cases but numerical methods are employed for solving most of the problems encountered in science and engineering. Here we explore some of the popular methods for solving the initial value problems involving first-order ordinary differential equations(ODE). The focus will be on solving simple examples using Python programming language. The Python basics required for understanding the examples is given <a class="reference external" href="../python/index.html">here</a>.</p>
<p>Consider the differential equation,</p>
<p><span class="formula"><span class="fraction"><span class="ignored">(</span><span class="numerator"><i>dy</i></span><span class="ignored">)/(</span><span class="denominator"><i>dx</i></span><span class="ignored">)</span></span> = <i>f</i>(<i>x</i>, <i>y</i>)</span>  with an initial value <span class="formula"><i>y</i>(<i>x</i><sub>0</sub>) = <i>y</i><sub>0</sub></span></p>
<p>The derivative of the function and the value of the function at some initial value are known. The objective is to find out the value of the function for other values of x, starting from the given initial point. The underlying idea of any routine for solving the initial value problem is to rewrite the dy and dx as finite steps <span class="formula">Δ<i>x</i></span> and <span class="formula">Δ<i>x</i></span>, to convert the differential equation to an algebraic equation.</p>
<p><span class="formula"><i>y</i>(<i>x</i><sub><i>i</i> + 1</sub>) = <i>y</i><sub><i>i</i></sub> + Δ<i>y</i> = <i>y</i><sub><i>i</i></sub> + <span class="fraction"><span class="ignored">(</span><span class="numerator">Δ<i>y</i></span><span class="ignored">)/(</span><span class="denominator">Δ<i>x</i></span><span class="ignored">)</span></span> × Δ<i>x</i> = <i>y</i><sub><i>i</i></sub> + <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>dy</i></span><span class="ignored">)/(</span><span class="denominator"><i>dx</i></span><span class="ignored">)</span></span> × Δ<i>x</i></span></p>
<p>In the limit of making <span class="formula">Δ<i>x</i></span> very small, a good approximation to the underlying differential equation is achieved. The process can be explained better with some examples. We choose a known function so that the error in the result can be easily checked.</p>
<p><a class="reference external" href="code/euler-sine.py">euler-sine.py</a>.</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword namespace">as</span> <span class="name namespace">np</span>
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.pyplot</span> <span class="keyword namespace">as</span> <span class="name namespace">plt</span>

<span class="keyword">def</span> <span class="name function">f1</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">):</span>            <span class="comment single"># derivative of the function to be evaluated</span>
        <span class="keyword">return</span> <span class="name">np</span><span class="operator">.</span><span class="name">cos</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">)</span>

<span class="name">N</span> <span class="operator">=</span> <span class="literal number integer">4</span>                   <span class="comment single"># number of points</span>
<span class="name">h</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span> <span class="name">pi</span><span class="operator">/</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">)</span>        <span class="comment single"># stepsize. Note that the Number of steps = Number of points -1</span>

<span class="name">xa</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array of store the variable values</span>
<span class="name">ya</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array to store results</span>

<span class="name">xa</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>
<span class="name">ya</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>

<span class="keyword">def</span> <span class="name function">euler</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">,</span> <span class="name">fxy</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">):</span>
        <span class="keyword">return</span> <span class="name">y</span> <span class="operator">+</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">)</span>   <span class="comment single"># Euler method</span>

<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">):</span>
        <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">euler</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">f1</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">)</span>
        <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="name">h</span>

<span class="keyword">print</span> <span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span>  <span class="literal string single">'Err = '</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]))</span>   <span class="comment single"># the last point and error</span>

<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">,</span> <span class="literal string single">'x-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">),</span> <span class="literal string single">'+-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
</pre>
<img alt="pics/euler-sine.png" src="pics/euler-sine.png" style="width: 400px;" />
<p>The output of the code is shown above. We have deliberately selected a very large stepsize to show the error. The lower graph, marked with dots, are the correct values. The points marked with crosses are the outputs of the calculation. The reason for error is very clear. The Euler method which advances a solution from <span class="formula"><i>x</i><sub><i>i</i></sub></span> to <span class="formula"><i>x</i><sub><i>i</i> + 1</sub></span> is not symmetric, it advances the solution through an interval h, but uses derivative information only at the beginning of that interval.</p>
<p>Better results are obtained if we take trial step to the midpoint of the interval and use the value of both x and y at that point to compute the real step across the whole interval. This is called the second-order Runge-Kutta or the midpoint method. To learn about the theory refer to <a class="reference external" href="http://www.math.iit.edu/~fass/478578_Chapter_3.pdf">Runge-Kutta methods</a>  , <a class="reference external" href="http://mathforcollege.com/nm/mws/gen/08ode/mws_gen_ode_txt_runge2nd.pdf">Second order Runge-Kutta methods</a> or any other good books on numerical methods.</p>
<p><a class="reference external" href="code/euler-sine.py">rk2-sine.py</a>.</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword namespace">as</span> <span class="name namespace">np</span>
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.pyplot</span> <span class="keyword namespace">as</span> <span class="name namespace">plt</span>

<span class="keyword">def</span> <span class="name function">f1</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">):</span>            <span class="comment single"># derivative of the function to be evaluated</span>
        <span class="keyword">return</span> <span class="name">np</span><span class="operator">.</span><span class="name">cos</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">)</span>

<span class="name">N</span> <span class="operator">=</span> <span class="literal number integer">4</span>                           <span class="comment single"># number of points</span>
<span class="name">h</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">pi</span><span class="operator">/</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">)</span>         <span class="comment single"># stepsize. Note that the Number of steps = Number of points -1</span>

<span class="name">xa</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array of store the variable values</span>
<span class="name">ya</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array to store results</span>

<span class="name">xa</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>
<span class="name">ya</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>

<span class="keyword">def</span> <span class="name function">rk2</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">,</span> <span class="name">fxy</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">):</span>   <span class="comment single"># x, y , f(x,y)</span>
        <span class="name">k1</span> <span class="operator">=</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">)</span>
        <span class="name">k2</span> <span class="operator">=</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span> <span class="operator">+</span> <span class="name">h</span><span class="punctuation">,</span> <span class="name">h</span><span class="operator">*</span><span class="name">k1</span><span class="punctuation">)</span>
        <span class="keyword">return</span> <span class="name">y</span> <span class="operator">+</span> <span class="name">h</span> <span class="operator">*</span> <span class="punctuation">(</span> <span class="name">k1</span><span class="operator">/</span><span class="literal number integer">2</span> <span class="operator">+</span> <span class="name">k2</span><span class="operator">/</span><span class="literal number integer">2</span><span class="punctuation">)</span>

<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">):</span>
        <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">rk2</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">f1</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">)</span>
        <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="name">h</span>

<span class="keyword">print</span> <span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span>  <span class="literal string single">'Err = '</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]))</span>

<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">,</span> <span class="literal string single">'x-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">),</span> <span class="literal string single">'o-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
</pre>
<img alt="pics/rk2-sine.png" src="pics/rk2-sine.png" style="width: 400px;" />
<p>This procedure can be further extended to higher orders. The fourth order Runge-Kutta method is the most popular one and is commonly referred as the Runge-Kutta method. In each step the derivative is evaluated four times as shown in figure below. Once at the initial point, twice at trial midpoints, and once at a trial endpoint. Every trial evaluation uses the value of the function from the previous trial point, ie. <span class="formula"><i>k</i><sub>2</sub></span> is evaluated using <span class="formula"><i>k</i><sub>1</sub></span> and not using <span class="formula"><i>y</i><sub><i>i</i></sub></span>. From these derivatives the final function value is calculated.</p>
<p><a class="reference external" href="code/rk4-sine.py">rk4-sine.py</a>.</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword namespace">as</span> <span class="name namespace">np</span>
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.pyplot</span> <span class="keyword namespace">as</span> <span class="name namespace">plt</span>

<span class="keyword">def</span> <span class="name function">f1</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">):</span>            <span class="comment single"># derivative of the function to be evaluated</span>
        <span class="keyword">return</span> <span class="name">np</span><span class="operator">.</span><span class="name">cos</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">)</span>

<span class="name">N</span> <span class="operator">=</span> <span class="literal number integer">4</span>                           <span class="comment single"># number of points</span>
<span class="name">h</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">pi</span><span class="operator">/</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">)</span>         <span class="comment single"># stepsize. Note that the Number of steps = Number of points -1</span>

<span class="name">xa</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array of store the variable values</span>
<span class="name">ya</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array to store results</span>

<span class="name">xa</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>
<span class="name">ya</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>

<span class="keyword">def</span> <span class="name function">rk4</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">,</span> <span class="name">fxy</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">):</span>   <span class="comment single"># x, y , f(x,y)</span>
        <span class="name">k1</span> <span class="operator">=</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">)</span>
        <span class="name">k2</span> <span class="operator">=</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span> <span class="operator">+</span> <span class="name">h</span><span class="operator">/</span><span class="literal number float">2.0</span><span class="punctuation">,</span> <span class="name">y</span><span class="operator">+</span><span class="name">k1</span><span class="operator">/</span><span class="literal number integer">2</span><span class="punctuation">)</span>
        <span class="name">k3</span> <span class="operator">=</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span> <span class="operator">+</span> <span class="name">h</span><span class="operator">/</span><span class="literal number float">2.0</span><span class="punctuation">,</span> <span class="name">y</span><span class="operator">+</span><span class="name">k2</span><span class="operator">/</span><span class="literal number integer">2</span><span class="punctuation">)</span>
        <span class="name">k4</span> <span class="operator">=</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span> <span class="operator">+</span> <span class="name">h</span><span class="punctuation">,</span> <span class="name">y</span><span class="operator">+</span><span class="name">k3</span><span class="punctuation">)</span>
        <span class="keyword">return</span>  <span class="name">y</span> <span class="operator">+</span> <span class="punctuation">(</span> <span class="name">k1</span><span class="operator">/</span><span class="literal number integer">6</span> <span class="operator">+</span> <span class="name">k2</span><span class="operator">/</span><span class="literal number integer">3</span> <span class="operator">+</span> <span class="name">k3</span><span class="operator">/</span><span class="literal number integer">3</span> <span class="operator">+</span> <span class="name">k4</span><span class="operator">/</span><span class="literal number integer">6</span> <span class="punctuation">)</span>

<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">):</span>
        <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">rk4</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">f1</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">)</span>
        <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="name">h</span>

<span class="keyword">print</span> <span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span>  <span class="literal string single">'Err = '</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]))</span>

<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">,</span> <span class="literal string single">'x-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">),</span> <span class="literal string single">'o-'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
</pre>
<img alt="pics/rk4-sine.png" src="pics/rk4-sine.png" style="width: 400px;" />
<p>The reduction is error is clearly visible. We have used very coarse steps to highlight the error. You may change the value of 'N' in the code and rerun. Outputs for N=100 are shown below. Also change the code to remove the marking of points.</p>
<img alt="pics/euler-sine-100N.png" src="pics/euler-sine-100N.png" style="width: 300px;" />
<img alt="pics/rk2-sine-100N.png" src="pics/rk2-sine-100N.png" style="width: 300px;" />
<img alt="pics/rk4-sine-100N.png" src="pics/rk4-sine-100N.png" style="width: 300px;" />
<p>As we explained earlier, the error is due to the fact that the value of the derivative is not the same everywhere. This can be demonstrated by choosing a function representing a straight line, as shown in the example below.</p>
<p><a class="reference external" href="code/euler-line.py">euler-line.py</a>.</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword namespace">as</span> <span class="name namespace">np</span>
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.pyplot</span> <span class="keyword namespace">as</span> <span class="name namespace">plt</span>


<span class="keyword">def</span> <span class="name function">f1</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">):</span>            <span class="comment single"># derivative of the function to be evaluated</span>
        <span class="keyword">return</span> <span class="literal number integer">4</span>

<span class="name">N</span> <span class="operator">=</span> <span class="literal number integer">4</span>                           <span class="comment single"># number of points</span>
<span class="name">h</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">pi</span><span class="operator">/</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">)</span>                 <span class="comment single"># stepsize. Note that the Number of steps = Number of points -1</span>

<span class="name">xa</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>        <span class="comment single"># numpy array of store the variable values</span>
<span class="name">ya</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">(</span><span class="name">N</span><span class="punctuation">)</span>                <span class="comment single"># numpy array to store results</span>

<span class="name">xa</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>
<span class="name">ya</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span>

<span class="keyword">def</span> <span class="name function">euler</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span> <span class="name">y</span><span class="punctuation">,</span> <span class="name">fxy</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">):</span>
        <span class="keyword">return</span> <span class="name">y</span> <span class="operator">+</span> <span class="name">h</span> <span class="operator">*</span> <span class="name">fxy</span><span class="punctuation">(</span><span class="name">x</span><span class="punctuation">,</span><span class="name">y</span><span class="punctuation">)</span>   <span class="comment single"># Euler method</span>

<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name">N</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">):</span>
        <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">euler</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">],</span> <span class="name">f1</span><span class="punctuation">,</span> <span class="name">h</span><span class="punctuation">)</span>
        <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">xa</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="name">h</span>

<span class="keyword">print</span> <span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">],</span>  <span class="literal string single">'Err = '</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="literal number integer">4</span><span class="operator">*</span><span class="name">xa</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">])</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="name">ya</span><span class="punctuation">,</span> <span class="literal string single">'x'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">xa</span><span class="punctuation">,</span> <span class="literal number integer">4</span><span class="operator">*</span><span class="name">xa</span><span class="punctuation">,</span> <span class="literal string single">'+'</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
</pre>
</div>
</body>
</html>
